### Ribbon

### 是什么，包含了哪些功能
ribbon是个IPC(进程间通信)框架，包含内置的负载均衡器；包含的功能：  
1. 负载均衡
2. 容错机制
3. 支持多种协议(http、TCP、UDP)
4. 缓存/批处理  

特性：
1. ribbon提供了一些内置的负载均衡规则，用户可以自定义路由规则
2. ribbon可以和服务注册发现服务集成，动态的提供服务
3. 支持和云进行集成
4. 内置了故障恢复能力；Ribbon可以通过IPing接口动态确定服务器的活动状态，并跳过不再活跃的服务器；Ribbon还可以进一步通过断路器模式过滤服务器
5. Ribbon提供了将负载均衡器和客户端集成在一起的接口和抽象类；它本身包含了一个Ribbo-HttpClient;用户也可以通过实现接口和抽象类来实现自己的客户端
6. Ribbon利用Archaius提供了一种简便的方法，可以从基于配置的客户端工厂中创建负载均衡器和客户端的实例

### 为什么要用ribbon
1. 可以给我们提供带负载均衡的客户端
2. 可以与服务注册发现服务集成，提供动态的服务列表
3. 可以提供容错机制

### 应用场景
1. 基于springcloud搭建的微服务

### 如何使用
参考官方文档

### 设计思路

**负载均衡路由规则**  
1. RoundRobinRule（轮询）：基于轮询规则选择服务器
2. AvailabilityFilteringRule(可用性过滤规则)：这个规则会把熔断的服务和并发数太大的服务跳过  
熔断的规则：  
当client最近3次（默认，可配置）没有与server连接上，断路器会打开；熔断时间30s（默认，可配置）后，断路器会闭合；如果继续连接失败，断路器会打开，熔断时间会成倍加长。  
https://github.com/Netflix/ribbon/wiki/Working-with-load-balancers
3. WeightedResponseTimeRule（基于响应时间权重路由规则）：会根据服务的平均响应时间设置权重，响应时间越长，权重越小；该路由规则采用的随机选择算法  

**整体的设计流程**

参考文章：  
https://cloud.tencent.com/developer/article/1528285


